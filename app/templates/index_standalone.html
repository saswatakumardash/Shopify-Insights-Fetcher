<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Shopify Insights</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
    <style>
      :root {
        --brand-accent: #2ea043;
        --accent-hover: #238636;
        --bg-base: #0d1117;
        --bg-surface: #161b22;
        --bg-overlay: #21262d;
        --header-bg: rgba(13, 17, 23, 0.95);
        --border-default: #30363d;
        --border-muted: #21262d;
        --text-primary: #f0f6fc;
        --text-secondary: #8b949e;
        --text-muted: #656d76;
        --shadow-default: 0 8px 24px rgba(1, 4, 9, 0.15);
        --shadow-medium: 0 16px 32px rgba(1, 4, 9, 0.15);
      }
      html[data-theme="light"] {
        --brand-accent: #1f883d;
        --accent-hover: #1a7f37;
        --bg-base: #ffffff;
        --bg-surface: #f6f8fa;
        --bg-overlay: #ffffff;
        --header-bg: rgba(255, 255, 255, 0.95);
        --border-default: #d0d7de;
        --border-muted: #d8dee4;
        --text-primary: #1f2328;
        --text-secondary: #656d76;
        --text-muted: #8b949e;
        --shadow-default: 0 8px 24px rgba(140, 149, 159, 0.2);
        --shadow-medium: 0 16px 32px rgba(140, 149, 159, 0.15);
      }
      
      * { box-sizing: border-box; }
      
      body {
        margin: 0;
        min-height: 100vh;
        background: var(--bg-base);
        color: var(--text-primary);
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif;
        line-height: 1.5;
      }
      
      header.appbar {
        position: sticky;
        top: 0;
        backdrop-filter: blur(12px);
        background: var(--header-bg);
        z-index: 50;
        height: 40px;
        display: flex;
        align-items: center;
      }
      .appbar .wrap { 
        max-width: 1280px; 
        margin: 0 auto; 
        padding: 0 16px; 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        width: 100%;
      }
      .brand { 
        display: flex; 
        gap: 8px; 
        align-items: center; 
        font-weight: 600; 
        font-size: 16px;
        color: var(--text-primary);
        text-decoration: none;
      }
      .brand .dot { 
        width: 8px; 
        height: 8px; 
        border-radius: 50%; 
        background: var(--brand-accent);
      }
      .brand.has-logo .dot { display: none; }
      .brand img.logo { 
        height: 20px; 
        width: auto; 
        display: none; 
        border-radius: 4px; 
      }
      .brand img.logo:hover { opacity: 0.8; transition: opacity 0.2s; }
      
      .container { max-width: 1280px; margin: 0 auto; padding: 24px; }
      
      .hero {
        text-align: center;
        padding: 48px 0;
        margin-bottom: 32px;
      }
      
      .hero h1 {
        font-size: 48px;
        font-weight: 600;
        margin: 0 0 16px 0;
        color: var(--text-primary);
      }
      
      .hero p {
        font-size: 20px;
        color: var(--text-secondary);
        margin: 0;
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.6;
      }
      
      .card { 
        background: var(--bg-surface);
        border: 1px solid var(--border-default);
        border-radius: 12px;
        padding: 24px;
        box-shadow: var(--shadow-default);
        margin-bottom: 24px;
      }
      
      .form-group {
        margin-bottom: 16px;
      }
      
      .form-group label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-primary);
        font-size: 16px;
      }
      
      .form-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 16px;
        align-items: end;
      }
      
      input, textarea {
        width: 100%;
        padding: 14px;
        border: 1px solid var(--border-default);
        border-radius: 6px;
        background: var(--bg-base);
        color: var(--text-primary);
        font-size: 16px;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      
      input:focus, textarea:focus {
        outline: none;
        border-color: var(--brand-accent);
        box-shadow: 0 0 0 3px rgba(46, 160, 67, 0.1);
      }
      
      .input-group {
        max-width: 120px;
      }
      
      textarea {
        resize: vertical;
        min-height: 80px;
      }
      
      .checkbox-group {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 16px 0;
      }
      
      .checkbox-group input[type="checkbox"] {
        width: auto;
        margin: 0;
      }
      
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        border: 1px solid var(--border-default);
        border-radius: 6px;
        background: var(--brand-accent);
        color: white;
        font-weight: 500;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
        text-decoration: none;
      }
      
      .btn:hover {
        background: var(--accent-hover);
        transform: translateY(-1px);
      }
      
      .btn-secondary {
        background: transparent;
        color: var(--text-primary);
        border-color: var(--border-default);
      }
      
      .btn-secondary:hover {
        background: var(--bg-overlay);
      }
      
      .btn-group {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 16px;
      }
      
      pre { 
        white-space: pre-wrap; 
        word-break: break-word; 
        background: var(--bg-base);
        color: var(--text-primary);
        padding: 16px;
        border-radius: 6px;
        border: 1px solid var(--border-default);
        font-size: 12px;
        overflow-x: auto;
      }
      .muted { color: var(--text-muted); font-size: 14px; }
      
      footer { 
        margin-top: 64px; 
        padding: 24px 0; 
        border-top: 1px solid var(--border-muted); 
        text-align: center; 
      }
      
      .link { 
        color: var(--brand-accent); 
        text-decoration: none; 
      }
      .link:hover { 
        text-decoration: underline; 
      }
      
      .toggle {
        display: inline-flex; 
        align-items: center; 
        gap: 6px; 
        cursor: pointer; 
        font-size: 14px;
        color: var(--text-secondary);
      }
      
      .toggle input[type="checkbox"] {
        width: auto;
        margin: 0;
      }
      
      @media (max-width: 768px) {
        .appbar .wrap { padding: 0 8px; }
        .container { padding: 16px; }
        .hero { padding: 32px 0; }
        .hero h1 { font-size: 24px; }
        .form-row { grid-template-columns: 1fr; }
        .card { padding: 16px; }
      }
    </style>
  </head>
  <body>
    <header class="appbar">
      <div class="wrap">
        <div class="brand"><img id="brandLogo" class="logo" alt="Logo" /><span class="dot"></span> <span>Shopify Insights</span></div>
        <label class="toggle">
          <input type="checkbox" id="themeToggle" role="switch" />
          <span>Dark mode</span>
        </label>
      </div>
    </header>

    <main class="container">
      <div class="hero">
        <h1>Shopify Store Insights</h1>
        <p>Analyze any Shopify store to extract products, policies, FAQs, social links, and discover competitors using AI.</p>
      </div>

      <div class="card">
        <form id="form" method="post">
          <div class="form-row">
            <div class="form-group">
              <label for="website_url">Shopify Store URL</label>
              <input type="url" id="website_url" name="website_url" placeholder="https://example.myshopify.com" required />
            </div>
            <div class="form-group">
              <label for="limit">Competitor Limit</label>
              <input type="number" id="limit" name="limit" min="1" max="10" value="5" class="input-group" />
            </div>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="fetch_competitors" name="fetch_competitors" />
            <label for="fetch_competitors">Auto-discover competitors using AI</label>
          </div>
          
          <div class="form-group">
            <label for="competitor_urls">Manual Competitor URLs (Optional)</label>
            <textarea id="competitor_urls" name="competitor_urls" rows="3" placeholder="Enter one URL per line:&#10;https://competitor1.com&#10;https://competitor2.myshopify.com"></textarea>
          </div>
          
          <div class="btn-group">
            <button type="submit" class="btn">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M6.5 1A1.5 1.5 0 005 2.5v2A1.5 1.5 0 006.5 6h4A1.5 1.5 0 0012 4.5v-2A1.5 1.5 0 0010.5 1h-4zM6.5 2.5a.5.5 0 01.5-.5h3a.5.5 0 01.5.5v1.5a.5.5 0 01-.5.5h-3a.5.5 0 01-.5-.5v-1.5z"/>
                <path d="M2 7.5A1.5 1.5 0 013.5 6h1A1.5 1.5 0 016 7.5v6A1.5 1.5 0 014.5 15h-1A1.5 1.5 0 012 13.5v-6zM3.5 7a.5.5 0 00-.5.5v6a.5.5 0 00.5.5h1a.5.5 0 00.5-.5v-6a.5.5 0 00-.5-.5h-1zM10 7.5A1.5 1.5 0 0111.5 6h1A1.5 1.5 0 0114 7.5v6a1.5 1.5 0 01-1.5 1.5h-1A1.5 1.5 0 0110 13.5v-6zM11.5 7a.5.5 0 00-.5.5v6a.5.5 0 00.5.5h1a.5.5 0 00.5-.5v-6a.5.5 0 00-.5-.5h-1z"/>
              </svg>
              Analyze Store
            </button>
            <button type="button" id="clearBtn" class="btn btn-secondary">Clear</button>
          </div>
        </form>
      </div>

      <div id="result" class="card" style="display:none;">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom: 16px;">
          <h3 style="margin:0; font-size: 18px;">Analysis Results</h3>
          <button type="button" id="copyBtn" class="btn btn-secondary">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"/>
              <path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"/>
            </svg>
            Copy JSON
          </button>
        </div>
        <pre id="json"></pre>
      </div>

      <footer>
        <small class="muted">Made by <a class="link" href="https://skds.site" target="_blank" rel="noopener">Saswata Kumar Dash</a>. Built with FastAPI.</small>
      </footer>
    </main>

    <script>
      // Theme init/persist
      (function() {
        const key = 'theme';
        const saved = localStorage.getItem(key);
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        const initial = saved || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', initial);
        const cb = document.getElementById('themeToggle');
        if (cb) cb.checked = (initial === 'dark');
        function setTheme(mode){ document.documentElement.setAttribute('data-theme', mode); localStorage.setItem(key, mode); }
        if (cb) cb.addEventListener('change', e => setTheme(e.target.checked ? 'dark' : 'light'));
        
        // apply logo from localStorage if provided
        const defaultLogo = '/assets/logo512.png';
        const logoUrl = localStorage.getItem('LOGO_URL') || defaultLogo;
        const logoImg = document.getElementById('brandLogo');
        if (logoUrl && logoImg) {
          // Test if logo loads successfully
          const testImg = new Image();
          testImg.onload = function() {
            logoImg.src = logoUrl;
            logoImg.style.display = 'block';
            const brand = document.querySelector('.brand');
            if (brand) brand.classList.add('has-logo');
          };
          testImg.onerror = function() {
            // Fallback to dot if logo fails to load
            logoImg.style.display = 'none';
          };
          testImg.src = logoUrl;
        }
      })();

      const form = document.getElementById('form');
      const result = document.getElementById('result');
      const jsonEl = document.getElementById('json');
      const copyBtn = document.getElementById('copyBtn');
      const clearBtn = document.getElementById('clearBtn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        result.style.display = 'none';
        jsonEl.textContent = 'Loading...';
        result.style.display = 'block';

        const data = new FormData(form);
        const url = data.get('website_url');
        const fetchCompetitors = data.get('fetch_competitors') === 'on';
        const competitorsText = (data.get('competitor_urls') || '').toString().trim();
        const competitorUrls = competitorsText ? competitorsText.split(/\n+/).map(s => s.trim()).filter(Boolean) : [];
        const limit = parseInt((data.get('limit')||'5'), 10) || 5;

        try {
          let payload = { website_url: url };
          let endpoint = '/api/insights';
          if (fetchCompetitors) {
            payload = { website_url: url, competitor_urls: competitorUrls, limit };
            endpoint = '/api/insights/competitors';
          }
          const res = await fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
          const body = await res.json();
          jsonEl.textContent = JSON.stringify(body, null, 2);
        } catch (err) {
          jsonEl.textContent = 'Error: ' + err.message;
        }
      });

      copyBtn?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(jsonEl.textContent || '');
          copyBtn.textContent = 'Copied!';
          setTimeout(()=> copyBtn.innerHTML = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"/><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"/></svg>Copy JSON', 1200);
        } catch {}
      });

      clearBtn?.addEventListener('click', () => {
        document.getElementById('website_url').value = '';
        document.getElementById('competitor_urls').value = '';
        document.getElementById('fetch_competitors').checked = false;
        result.style.display = 'none';
      });
    </script>
  </body>
</html>
